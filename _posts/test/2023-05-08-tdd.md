---
layout: post
title: 테스트 주도 개발 시작하기
date: 2023-04-16
categories: [test]
tags: [java, test, tdd]
---
# Test-driven Development

### 맛보기
```java
public class CalculatorTest {
    @Test
    void plus() {
        int result = Caculator.plus(1, 2);
        assertEquals(3, result);
    }
}
```
**계산기 class보다 test를 먼저 작성 시 고려사항**
1. method name
2. method arguments 의 개수
3. static vs instance method
4. class name

***
## TDD의 흐름
1. Test code 작성 -> red
2. function code 작성 -> green
    - 1에서 작성한 test를 만족하는 code만 작성 -> 3에서 부담없이 refactoring하고 test를 실행할 수 있다 
3. refactoring(test, function) - refactor

#### TDD의 Cycle: Red-Green-Refactor

***
1. 구현하기 쉬운 테스트부터 작성
2. 예외 상황 테스트부터 작성
   - 예외 상황을 나중에 반영하려면 코드가 복잡해진다.
3. 처음 tdd를 연습할 때은 다음의 순서대로 작성
   - 정해진 값을 return
   - 값 비교를 이용해서 정해진 값을 리턴
   - 다양한 테스트를 추가하며 구현을 일반화

***

## Test 방법
상황(given), 실행(when), 결과(then)을 생각하자. 때에 따라 상황(given)이 없는 경우도 있다.

만약 외부요인이 있다면(외부 api 호출, db 등)
-> 대역을 사용하면 좋다.

### 대역(double)
진짜 대신 사용할 대역

#### 대역의 필요성
테스트 대상이 외부 요인에 의존하는 경우, 외부 요인에 의해 테스트 결과가 달라질 수 있다.

#### 대역의 종류
- 스텁(stub)
  - 구현을 단순한 것으로 대체
  - 테스트에 맞게 단순히 원하는 동작을 수행
- 가짜(fake)
  - 제품에는 적합하지 않지만, 실제 동작하는 구현을 제공
- 스파이(spy)
  - 호출된 내역을 기록
  - 기록한 내용은 테스트 결과를 검증할 때 사용
  - stub이기도 하다
- 모의 객체
  - 기대한 대로 상호작용하는지 행위를 검증
  - 기대한 대로 동작하지 않으면 exception 발생
  - stub이자 spy

***
## 테스트 가능한 설계
테스트하기 어려운 코드를 수정하여 테스트를 가능하게 한다.

### 테스트하기 어려울 수 있는 코드
의존하는 코드를 교체할 수 있는 수단이 없을 때
- 하드 코딩된 정보(경로, IP, PORT)
  - 수정할 수 없기 때문에, 해당 정보가 테스트 환경에 들어맞아야 한다.
- 필드에 선언된 의존 객체를 직접 생성
  - 필드에 선언된 객체가 완벽하게 준비되어 있어야 한다.
- 정적 메서드의 사용(static method)
  - 사용하고 있는 정적 메서드가 외부 서버와 통신하는 경우, 외부 서버가 준비되어 있어야 한다.
- 실행 시점에 따라 달라지는 결과
  - LocalDateTime.now()가 코드에 존재하는 경우, 해당 값에 따라 테스트의 성공/실패 여부가 달라질 수 있다.
- 역할이 섞여 있는 코드
  - 의존관계에 있는 객체들을 너무 많이 사용하면, 많은 대역을 사용해야 한다.
- 그 외
  - 메서드 중간에 소켓 통신 코드가 포함
  - 콘솔에서 입력을 받거나 결과를 콘솔에 출력
  - 테스트 대상이 사용하는 의존 대상 클래스/메서드가 final인 경우, 대역으로 대체하기 어려움

### 테스트 가능한 설계
- 하드 코딩된 정보를 생성자나 메서드 파라미터로 전달
- 의존 대상을 주입(생성자, 세터 이용)
- 테스트하고 싶은 코드 분리
- 시간이나 임의값 생성 기능 분리
- 외부 라이브러리는 직접 사용하지 말고 감싸서 사용
  - 특히 외부 라이브러리가 정적 메서드를 사용하는 경우, 대체불가할 수 있다.
- 

























